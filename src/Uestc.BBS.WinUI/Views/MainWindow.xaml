<?xml version="1.0" encoding="utf-8" ?>
<winex:WindowEx
    x:Class="Uestc.BBS.WinUI.Views.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:core="using:Uestc.BBS.Core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:Uestc.BBS.WinUI"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:tb="using:H.NotifyIcon"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:winex="using:WinUIEx"
    Title="清水河畔"
    Width="1200"
    Height="800"
    MinWidth="900"
    MinHeight="560"
    mc:Ignorable="d">

    <winex:WindowEx.SystemBackdrop>
        <MicaBackdrop Kind="Base" />
    </winex:WindowEx.SystemBackdrop>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="47" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <tb:TaskbarIcon
            IconSource="/Assets/Icons/app.ico"
            LeftClickCommand="{x:Bind ShowMainViewCommand}"
            ToolTipService.Placement="Mouse"
            ToolTipText="清水河畔">
            <tb:TaskbarIcon.ContextFlyout>
                <MenuFlyout AreOpenCloseAnimationsEnabled="False">
                    <MenuFlyoutItem Command="{x:Bind OpenAboutDialogCommand}" Text="关于" />
                    <MenuFlyoutItem Text="检查更新" />
                    <MenuFlyoutSeparator />
                    <ToggleMenuFlyoutItem
                        Command="{x:Bind _viewModel.SwitchSliceStartCommand}"
                        IsChecked="{x:Bind _viewModel.SliceStart, Mode=TwoWay}"
                        Text="静默启动" />
                    <ToggleMenuFlyoutItem
                        Command="{x:Bind _viewModel.SwitchStartupOnLaunchCommand}"
                        IsChecked="{x:Bind _viewModel.StartupOnLaunch, Mode=TwoWay}"
                        Text="开机自启动" />
                    <MenuFlyoutSeparator />
                    <MenuFlyoutItem Command="{x:Bind RestartCommand}" Text="重新启动" />
                    <MenuFlyoutItem Command="{x:Bind ExitCommand}" Text="退出" />
                </MenuFlyout>
            </tb:TaskbarIcon.ContextFlyout>
        </tb:TaskbarIcon>
        <!--  标题栏  -->
        <controls:DockPanel Grid.Row="0" Margin="0,0,160,0">
            <AppBarButton
                Width="40"
                Margin="5,0"
                ToolTipService.ToolTip="返回"
                Visibility="Visible">
                <FontIcon Glyph="&#xEC52;" />
            </AppBarButton>
            <ImageIcon
                Height="18"
                Margin="10,0"
                Source="/Assets/Icons/app.ico" />
            <TextBlock
                Padding="0,0,0,1"
                VerticalAlignment="Center"
                FontFamily="Consolas"
                FontSize="13"
                Text="清水河畔" />
            <controls:Segmented Margin="15,0" SelectedIndex="0">
                <controls:SegmentedItem Icon="{ui:FontIcon Glyph=&#xE728;}" ToolTipService.ToolTip="我的收藏" />
                <controls:SegmentedItem Icon="{ui:FontIcon Glyph=&#xE932;}" ToolTipService.ToolTip="我的发表" />
                <controls:SegmentedItem Icon="{ui:FontIcon Glyph=&#xE90A;}" ToolTipService.ToolTip="我的回复" />
                <controls:SegmentedItem Icon="{ui:FontIcon Glyph=&#xE7B3;}" ToolTipService.ToolTip="我的插眼" />
            </controls:Segmented>
            <PersonPicture
                Height="35"
                controls:DockPanel.Dock="Right"
                Background="Transparent"
                BorderBrush="Transparent"
                PointerPressed="PersonPicture_PointerPressed"
                ProfilePicture="https://bbs.uestc.edu.cn/uc_server/data/avatar/000/25/68/25_avatar_middle.jpg">
                <FlyoutBase.AttachedFlyout>
                    <Flyout Placement="BottomEdgeAlignedRight">
                        <StackPanel MaxWidth="300">
                            <StackPanel Orientation="Horizontal" Spacing="10">
                                <PersonPicture
                                    Height="48"
                                    VerticalAlignment="Top"
                                    controls:DockPanel.Dock="Left"
                                    ProfilePicture="https://bbs.uestc.edu.cn/uc_server/data/avatar/000/25/68/25_avatar_big.jpg" />
                                <!--  昵称、签名  -->
                                <StackPanel VerticalAlignment="Center" Spacing="3">
                                    <StackPanel Orientation="Horizontal" Spacing="5">
                                        <TextBlock FontWeight="SemiBold" Text="Redns" />
                                        <Border Background="{ThemeResource SystemFillColorSuccessBrush}" CornerRadius="3">
                                            <TextBlock
                                                Margin="3,0"
                                                Padding="0,1,0,0"
                                                FontSize="12"
                                                Foreground="White"
                                                Text="Lv.6" />
                                        </Border>
                                        <Border Background="{ThemeResource AccentTextFillColorTertiaryBrush}" CornerRadius="3">
                                            <TextBlock
                                                Margin="3,0"
                                                Padding="0,1,0,0"
                                                FontSize="11"
                                                Foreground="White"
                                                Text="成电校友" />
                                        </Border>
                                    </StackPanel>
                                    <TextBlock
                                        FontSize="12"
                                        Foreground="Gray"
                                        Text="早熟的人通常都晚熟，骄傲的人又很急性" />
                                    <!--  退出登录  -->
                                    <HyperlinkButton
                                        Margin="-5,0"
                                        Padding="5"
                                        Content="退出登录"
                                        FontSize="12" />
                                </StackPanel>
                            </StackPanel>
                        </StackPanel>
                    </Flyout>
                </FlyoutBase.AttachedFlyout>
            </PersonPicture>
            <AutoSuggestBox
                MaxWidth="520"
                Margin="15,0"
                VerticalAlignment="Center"
                PlaceholderText="{x:Bind _viewModel.SearchPlaceholderText, Mode=OneWay}"
                QueryIcon="Find" />
        </controls:DockPanel>
        <!--  导航栏  -->
        <NavigationView
            x:Name="navigateView"
            Grid.Row="1"
            CompactPaneLength="70"
            CompositeMode="Inherit"
            IsBackButtonVisible="Collapsed"
            IsPaneOpen="False"
            IsPaneToggleButtonVisible="False"
            IsSettingsVisible="False"
            ItemInvoked="NavigateToPage">
            <NavigationView.MenuItems>
                <!--  首页  -->
                <NavigationViewItem Height="65" Tag="HomePage">
                    <NavigationViewItem.Content>
                        <StackPanel
                            Padding="-10,0,0,0"
                            HorizontalAlignment="Center"
                            Spacing="4">
                            <FontIcon FontSize="23" Glyph="&#xE80F;" />
                            <TextBlock FontSize="13" Text="首页" />
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>
                <!--  版块  -->
                <NavigationViewItem Height="65" Tag="SectionsPage">
                    <NavigationViewItem.Content>
                        <StackPanel
                            Padding="-10,0,0,0"
                            HorizontalAlignment="Center"
                            Spacing="4">
                            <FontIcon FontSize="23" Glyph="&#xE74C;" />
                            <TextBlock FontSize="13" Text="版块" />
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>
                <!--  服务  -->
                <NavigationViewItem Height="65" Tag="ServicesPage">
                    <NavigationViewItem.Content>
                        <StackPanel
                            Padding="-10,0,0,0"
                            HorizontalAlignment="Center"
                            Spacing="4">
                            <FontIcon FontSize="23" Glyph="&#xE81E;" />
                            <TextBlock FontSize="13" Text="服务" />
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>
                <!--  动态  -->
                <NavigationViewItem Height="65" Tag="MomentsPage">
                    <NavigationViewItem.Content>
                        <StackPanel
                            Padding="-10,0,0,0"
                            HorizontalAlignment="Center"
                            Spacing="4">
                            <FontIcon FontSize="23" Glyph="&#xE909;" />
                            <TextBlock FontSize="13" Text="动态" />
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>
                <!--  发布  -->
                <NavigationViewItem Height="65" Tag="PostPage">
                    <NavigationViewItem.Content>
                        <StackPanel
                            Padding="-10,0,0,0"
                            HorizontalAlignment="Center"
                            Spacing="4">
                            <FontIcon FontSize="23" Glyph="&#xECCD;" />
                            <TextBlock FontSize="13" Text="发布" />
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>
            </NavigationView.MenuItems>
            <NavigationView.FooterMenuItems>
                <!--  消息  -->
                <NavigationViewItem Height="65" Tag="MessagesPage">
                    <NavigationViewItem.Content>
                        <StackPanel
                            Padding="-10,0,0,0"
                            HorizontalAlignment="Center"
                            Spacing="4">
                            <FontIcon FontSize="23" Glyph="&#xE715;" />
                            <TextBlock FontSize="13" Text="消息" />
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>
                <!--  设置  -->
                <NavigationViewItem Height="65" Tag="SettingsPage">
                    <NavigationViewItem.Content>
                        <StackPanel
                            Padding="-10,0,0,0"
                            HorizontalAlignment="Center"
                            Spacing="4">
                            <FontIcon FontSize="23" Glyph="&#xE713;" />
                            <TextBlock FontSize="13" Text="设置" />
                        </StackPanel>
                    </NavigationViewItem.Content>
                </NavigationViewItem>
            </NavigationView.FooterMenuItems>
            <Frame x:Name="navigateFrame" />
        </NavigationView>
    </Grid>
</winex:WindowEx>
